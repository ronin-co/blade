---
title: Auth
---

# Auth

Blade natively offers the [blade-auth](https://github.com/ronin-co/blade/tree/main/packages/blade-auth) package,
which provides utility functions for easily adding different authentication methods to your application,
without having to maintain them.

The functionality of the package is built around [Triggers](/models/triggers), which make
it possible to capture Blade queries and run custom logic.

## Setup

To enable all default authentication features, create the following files in a directory
named `triggers` at the root of your application.

Additionally, a `BLADE_AUTH_SECRET` environment variable should be present in production
(not necessary during development because a default value is provided there), which must
contain the secret used to sign authentication tokens. You can run `openssl rand -base64 30` to
generate a new secret that you can store in the environment variable.

```ts
// triggers/account.ts

import type { AddTrigger, SetTrigger } from "blade/types";
import { addAccount, setAccount } from "blade/server/auth";

export const add: AddTrigger = addAccount;
export const set: SetTrigger = setAccount;
```

```ts
// triggers/session.ts

import type { GetTrigger, AddTrigger, RemoveTrigger } from "blade/types";
import { addSession, getSession, removeSession } from "blade/server/auth";

export const get: GetTrigger = getSession;
export const add: AddTrigger = addSession;
export const remove: RemoveTrigger = removeSession;
```

Additionally, place the following in your [Schema Definition](/models) located in
a `schema/index.ts` file at the root of your project:

```ts
export { Account, Session } from 'blade/server/auth';
```

## Status

To obtain the current status of a session, run the following query in a page:

```ts
const session = use.session();
```

To also include the current account, you can run the following:

```ts
const session = use.session.using(['account']);
```

## Actions

To trigger specific actions, you can then run one of the following queries with
the [useMutation](/hooks#usemutation-client) hook on the client-side, depending on what
actions the user performs.

In addition to the actions documented below, you can, of course, also run any
other [Query](/queries) for the models that `blade-auth` provides, such as `Account` and `Session`. For
example, you might choose to count records or filter them in a specific way.

You can choose between either running a **[Query](/hooks#usemutation-client)** or using Blade's **[Form](/components#form)** component.

### Signing Up

#### Query

```ts
await add.account.with({
    email: 'elaine@thorne.co',
    password: '1234'
});
```

#### Form

```tsx
<Form model="account">
  <Input type="email" name="email" placeholder="Email" />
  <Input type="password" name="password" placeholder="Password" />

  <button type="submit">Sign Up</button>
</Form>
```

### Logging In

This query will automatically set a `session` cookie.

#### Query

```ts
await add.session.with.account({
    email: 'elaine@thorne.co',
    password: '1234'
});
```

#### Form

```tsx
<Form model="session">
  <Input type="email" name="account.email" placeholder="Email" />
  <Input type="password" name="account.password" placeholder="Password" />

  <button type="submit">Log In</button>
</Form>
```

### Logging Out

This query will automatically revoke the `session` cookie.

```ts
await remove.session();
```

### Forgot Password

Used when the user forgot their password and therefore cannot log in.

#### Query

```ts
await set.account({
  with: { email: 'elaine@thorne.co' },
  to: { password: null }
});
```

#### Form

```tsx
<Form model="account">
  <Input type="email" name="email" placeholder="Email" target />
  <Input type="hidden" name="password" value={null} />

  <button type="submit">Send Confirmation</button>
</Form>
```

### Reset Password

Can be shown after the user clicked the link in the email that was sent by [Forgot Password](#forgot-password).

#### Query

```ts
const { searchParams } = useLocation();
const emailVerificationToken = searchParams.get('token');

await set.account({
  with: { emailVerificationToken },
  to: { password: 'my-new-password' }
});
```

#### Form

```tsx
const { searchParams } = useLocation();
const emailVerificationToken = searchParams.get('token');
const account = use.account.with({ emailVerificationToken });

{account ? (
  <Form model="account" target={{ emailVerificationToken }}>

    {/* Tells password managers which account to update. */}
    <Input type="hidden" name="email" value={account.email} />
    <Input type="password" name="password" placeholder="New Password" />

    <button type="submit">Change Password</button>
  </Form>
) : (
  <span>Your link has expired</span>
)}
```

## Utility Functions

Blade also re-exports a few helpful utility functions for authentication:

### `getSessionCookie`

This function can be used to parse the current `session` cookie inside a trigger.

For example, you could place the trigger below inside the trigger file of a model for
which you would like to log a message every time a record is added.

```ts
import type { FollowingAddTrigger } from "blade/types";
import { getSessionCookie } from 'blade/server/utils';

export const followingAdd: FollowingAddTrigger = async (_, _, options) => {
  const { accountId } = await getSessionCookie(options);
  console.log(`A new record was added by ${accountId}`);
};
```